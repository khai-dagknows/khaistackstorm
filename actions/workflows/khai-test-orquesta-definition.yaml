version: 1.0
description: Khai Test Orquesta Definition
vars:
  - message: 'Hello world'

input:
  - host
  - memory_threshold
  - cpu_threshold

tasks:
  setup_task:
    next:
      - do:
          - task1_memory_usage
#          - task2_top_memory_consumers
#          - task3_available_disk_space
#          - task4_cpu_usage

  task1_memory_usage:
    action: core.remote hosts=<% ctx().host %> cmd="free"
    next:
      - publish: message="task1_memory_usage_a result: <% result() %>"
      - do: output_message

#  task1_memory_usage_a:
#    action: khaistackstorm.parse_memory_usage str=<% result() %>
#    next:
#      - publish: message="task1_memory_usage_a result: <% result() %>"
#        do: output_message
  output_message:
    action: core.echo message=<% ctx('message') %>
#  barrier:
#    join: all
#    action: core.echo message="I need to output appropriate message in the barrier task based on the result"
